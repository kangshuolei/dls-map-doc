import{o as p,c as g,d as f,p as v,am as h,h as y,v as _,b as M,P as E}from"./framework.CRGMDg42.js";const S=(t,l)=>{const u=t.__vccOpts||t;for(const[e,s]of l)u[e]=s;return u},k=t=>(t.install=l=>{l.component(t.name,t)},t),D={mapConfig:{type:Object},viewerConfig:{type:Object},viewerWidth:{type:String,require:!1},viewerHeight:{type:String,require:!1}},x={cesiumReady:t=>!0},I={name:"LoadingSpinner"},T={class:"loading-spinner"};function L(t,l,u,e,s,i){return p(),g("div",T,"Loading...")}const b=S(I,[["render",L],["__scopeId","data-v-1b657085"]]),F=["id"],P=f({name:"dls-map"}),A=f({...P,props:D,emits:x,setup(t,{expose:l,emit:u}){const e=t,s=u,i=e.mapConfig,c=v(null),n=h({isCesiumLoaded:!1}),a=y(()=>(i==null?void 0:i.id)||"cesiumContainer"),m=()=>{const o=setInterval(()=>{try{Cesium&&(n.isCesiumLoaded=!0,E(()=>{clearInterval(o),d()}))}catch{}},100)},d=()=>{i!=null&&i.defaultAccessToken&&(Cesium.Ion.defaultAccessToken=i.defaultAccessToken);let o=new Cesium.Viewer(a.value,{baseLayerPicker:!1,geocoder:!1,animation:!1,shouldAnimate:!0,homeButton:!1,sceneMode:(i==null?void 0:i.sceneModeNum)===2?Cesium.SceneMode.SCENE2D:Cesium.SceneMode.SCENE3D,timeline:!1,fullscreenButton:!1,scene3DOnly:!1,sceneModePicker:!1,navigationInstructionsInitiallyVisible:!1,navigationHelpButton:!1,selectionIndicator:!1,infoBox:!1,imageryProvider:!1,...e.viewerConfig});var r=o.scene.canvas;r.style.width=e.viewerWidth||"100%",r.style.height=e.viewerHeight||"100%",(i!=null&&i.defaultAccessToken||i!=null&&i.imageryProvider)&&o.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider(i==null?void 0:i.imageryProvider)),o.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),c.value=o,s("cesiumReady",c.value)};return _(()=>{m()}),l({dataM:n,viewer:c}),(o,r)=>n.isCesiumLoaded?(p(),g("div",{key:0,id:a.value,style:{position:"absolute",width:"100%",height:"100%"},class:"dlsMapContainer"},null,8,F)):(p(),M(b,{key:1}))}}),B=k(A);function O(){const t=h({longitude:"0",latitude:"0",height:"0",altitude:"0",cameraHeading:"0",pitchDegrees:"0",zoomLevel:0});function l(e=null){if(!e)return console.error("viewer is undefined"),!1;if(e){let s=null;const i=e.camera,c=new Cesium.ScreenSpaceEventHandler(e.scene.canvas);c.setInputAction(function(n){const a=e.camera.pickEllipsoid(n.endPosition,e.scene.globe.ellipsoid);a&&(s&&clearTimeout(s),s=setTimeout(()=>{const m=Cesium.Cartographic.fromCartesian(a);t.longitude=Cesium.Math.toDegrees(m.longitude).toFixed(6),t.latitude=Cesium.Math.toDegrees(m.latitude).toFixed(6)},300))},Cesium.ScreenSpaceEventType.MOUSE_MOVE),c.setInputAction(function(n){let a=n.position;if(a)if(e.scene.mode===Cesium.SceneMode.SCENE3D){let d=e.scene.globe.pick(e.camera.getPickRay(a),e.scene);if(d){let o=Cesium.Cartographic.fromCartesian(d);t.longitude=Cesium.Math.toDegrees(o.longitude).toFixed(6),t.latitude=Cesium.Math.toDegrees(o.latitude).toFixed(6);let r=e.scene.globe.ellipsoid.cartesianToCartographic(d);r&&(t.altitude=e.scene.globe.getHeight(r).toFixed(2))}}else{let d=e.camera.pickEllipsoid(a,e.scene.globe.ellipsoid);if(d!==void 0){let o=Cesium.Cartographic.fromCartesian(d),r=Cesium.Math.toDegrees(o.longitude),C=Cesium.Math.toDegrees(o.latitude);t.longitude=r.toFixed(6),t.latitude=C.toFixed(6)}}},Cesium.ScreenSpaceEventType.LEFT_CLICK),c.setInputAction(function(n){t.height=e.camera.positionCartographic.height.toFixed(1);let a=u(Math.ceil(e.camera.positionCartographic.height));t.zoomLevel=a},Cesium.ScreenSpaceEventType.WHEEL),e.scene.camera.moveEnd.addEventListener(function(){let n=i.direction,a=Cesium.Math.toDegrees(Math.atan2(n.y,n.x));t.cameraHeading=((a+360)%360).toFixed(0);let m=i.pitch;t.pitchDegrees=Cesium.Math.toDegrees(m).toFixed(0)})}}function u(e){let s=40487.57,i=7096758e-11,c=91610.74,n=-40467.74;return Math.round(n+(s-n)/(1+Math.pow(e/c,i)))}return{listenToMouseMovement:l,coords:t}}export{B as D,O as u};

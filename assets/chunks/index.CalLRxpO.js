import{g as Oi,c as rt}from"./theme.DA5KsMvH.js";class Ri{constructor(){this.listeners=new Map([["drawStart",new Set],["drawUpdate",new Set],["drawEnd",new Set],["editStart",new Set],["editEnd",new Set]])}on(t,e){if(!this.listeners.has(t)){console.warn("Event binding must be one of 'drawStart', 'drawUpdate', or 'drawEnd'.");return}this.listeners.get(t).add(e)}off(t,e){this.listeners.has(t)&&this.listeners.get(t).delete(e)}dispatchEvent(t,e){this.listeners.has(t)&&this.listeners.get(t).forEach(i=>{i(e)})}}var at={exports:{}};at.exports;(function(c,t){var e=200,i="__lodash_hash_undefined__",o=9007199254740991,n="[object Arguments]",r="[object Array]",a="[object Boolean]",l="[object Date]",h="[object Error]",g="[object Function]",f="[object GeneratorFunction]",P="[object Map]",d="[object Number]",m="[object Object]",v="[object Promise]",M="[object RegExp]",C="[object Set]",L="[object String]",b="[object Symbol]",k="[object WeakMap]",_="[object ArrayBuffer]",I="[object DataView]",$="[object Float32Array]",_t="[object Float64Array]",Gt="[object Int8Array]",Dt="[object Int16Array]",kt="[object Int32Array]",It="[object Uint8Array]",Ft="[object Uint8ClampedArray]",xt="[object Uint16Array]",Wt="[object Uint32Array]",pe=/[\\^$.*+?()[\]{}|]/g,de=/\w*$/,fe=/^\[object .+?Constructor\]$/,Pe=/^(?:0|[1-9]\d*)$/,T={};T[n]=T[r]=T[_]=T[I]=T[a]=T[l]=T[$]=T[_t]=T[Gt]=T[Dt]=T[kt]=T[P]=T[d]=T[m]=T[M]=T[C]=T[L]=T[b]=T[It]=T[Ft]=T[xt]=T[Wt]=!0,T[h]=T[g]=T[k]=!1;var me=typeof rt=="object"&&rt&&rt.Object===Object&&rt,ye=typeof self=="object"&&self&&self.Object===Object&&self,W=me||ye||Function("return this")(),Ot=t&&!t.nodeType&&t,Rt=Ot&&!0&&c&&!c.nodeType&&c,we=Rt&&Rt.exports===Ot;function ve(s,u){return s.set(u[0],u[1]),s}function Me(s,u){return s.add(u),s}function Ce(s,u){for(var p=-1,y=s?s.length:0;++p<y&&u(s[p],p,s)!==!1;);return s}function Te(s,u){for(var p=-1,y=u.length,E=s.length;++p<y;)s[E+p]=u[p];return s}function Ht(s,u,p,y){for(var E=-1,G=s?s.length:0;++E<G;)p=u(p,s[E],E,s);return p}function Se(s,u){for(var p=-1,y=Array(s);++p<s;)y[p]=u(p);return y}function Le(s,u){return s==null?void 0:s[u]}function jt(s){var u=!1;if(s!=null&&typeof s.toString!="function")try{u=!!(s+"")}catch{}return u}function Bt(s){var u=-1,p=Array(s.size);return s.forEach(function(y,E){p[++u]=[E,y]}),p}function ct(s,u){return function(p){return s(u(p))}}function Ut(s){var u=-1,p=Array(s.size);return s.forEach(function(y){p[++u]=y}),p}var Ae=Array.prototype,Ee=Function.prototype,tt=Object.prototype,lt=W["__core-js_shared__"],Vt=function(){var s=/[^.]+$/.exec(lt&&lt.keys&&lt.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),Nt=Ee.toString,j=tt.hasOwnProperty,et=tt.toString,be=RegExp("^"+Nt.call(j).replace(pe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zt=we?W.Buffer:void 0,qt=W.Symbol,Xt=W.Uint8Array,_e=ct(Object.getPrototypeOf,Object),Ge=Object.create,De=tt.propertyIsEnumerable,ke=Ae.splice,Yt=Object.getOwnPropertySymbols,Ie=zt?zt.isBuffer:void 0,Fe=ct(Object.keys,Object),ut=X(W,"DataView"),J=X(W,"Map"),gt=X(W,"Promise"),pt=X(W,"Set"),dt=X(W,"WeakMap"),Q=X(Object,"create"),xe=N(ut),We=N(J),Oe=N(gt),Re=N(pt),He=N(dt),Kt=qt?qt.prototype:void 0,$t=Kt?Kt.valueOf:void 0;function U(s){var u=-1,p=s?s.length:0;for(this.clear();++u<p;){var y=s[u];this.set(y[0],y[1])}}function je(){this.__data__=Q?Q(null):{}}function Be(s){return this.has(s)&&delete this.__data__[s]}function Ue(s){var u=this.__data__;if(Q){var p=u[s];return p===i?void 0:p}return j.call(u,s)?u[s]:void 0}function Ve(s){var u=this.__data__;return Q?u[s]!==void 0:j.call(u,s)}function Ne(s,u){var p=this.__data__;return p[s]=Q&&u===void 0?i:u,this}U.prototype.clear=je,U.prototype.delete=Be,U.prototype.get=Ue,U.prototype.has=Ve,U.prototype.set=Ne;function O(s){var u=-1,p=s?s.length:0;for(this.clear();++u<p;){var y=s[u];this.set(y[0],y[1])}}function ze(){this.__data__=[]}function qe(s){var u=this.__data__,p=it(u,s);if(p<0)return!1;var y=u.length-1;return p==y?u.pop():ke.call(u,p,1),!0}function Xe(s){var u=this.__data__,p=it(u,s);return p<0?void 0:u[p][1]}function Ye(s){return it(this.__data__,s)>-1}function Ke(s,u){var p=this.__data__,y=it(p,s);return y<0?p.push([s,u]):p[y][1]=u,this}O.prototype.clear=ze,O.prototype.delete=qe,O.prototype.get=Xe,O.prototype.has=Ye,O.prototype.set=Ke;function z(s){var u=-1,p=s?s.length:0;for(this.clear();++u<p;){var y=s[u];this.set(y[0],y[1])}}function $e(){this.__data__={hash:new U,map:new(J||O),string:new U}}function Je(s){return st(this,s).delete(s)}function Qe(s){return st(this,s).get(s)}function Ze(s){return st(this,s).has(s)}function ti(s,u){return st(this,s).set(s,u),this}z.prototype.clear=$e,z.prototype.delete=Je,z.prototype.get=Qe,z.prototype.has=Ze,z.prototype.set=ti;function q(s){this.__data__=new O(s)}function ei(){this.__data__=new O}function ii(s){return this.__data__.delete(s)}function si(s){return this.__data__.get(s)}function ni(s){return this.__data__.has(s)}function oi(s,u){var p=this.__data__;if(p instanceof O){var y=p.__data__;if(!J||y.length<e-1)return y.push([s,u]),this;p=this.__data__=new z(y)}return p.set(s,u),this}q.prototype.clear=ei,q.prototype.delete=ii,q.prototype.get=si,q.prototype.has=ni,q.prototype.set=oi;function ri(s,u){var p=mt(s)||Gi(s)?Se(s.length,String):[],y=p.length,E=!!y;for(var G in s)j.call(s,G)&&!(E&&(G=="length"||Ai(G,y)))&&p.push(G);return p}function Jt(s,u,p){var y=s[u];(!(j.call(s,u)&&ee(y,p))||p===void 0&&!(u in s))&&(s[u]=p)}function it(s,u){for(var p=s.length;p--;)if(ee(s[p][0],u))return p;return-1}function ai(s,u){return s&&Qt(u,yt(u),s)}function ft(s,u,p,y,E,G,R){var D;if(y&&(D=G?y(s,E,G,R):y(s)),D!==void 0)return D;if(!nt(s))return s;var ne=mt(s);if(ne){if(D=Ti(s),!u)return vi(s,D)}else{var Y=V(s),oe=Y==g||Y==f;if(ki(s))return pi(s,u);if(Y==m||Y==n||oe&&!G){if(jt(s))return G?s:{};if(D=Si(oe?{}:s),!u)return Mi(s,ai(D,s))}else{if(!T[Y])return G?s:{};D=Li(s,Y,ft,u)}}R||(R=new q);var re=R.get(s);if(re)return re;if(R.set(s,D),!ne)var ae=p?Ci(s):yt(s);return Ce(ae||s,function(wt,ot){ae&&(ot=wt,wt=s[ot]),Jt(D,ot,ft(wt,u,p,y,ot,s,R))}),D}function hi(s){return nt(s)?Ge(s):{}}function ci(s,u,p){var y=u(s);return mt(s)?y:Te(y,p(s))}function li(s){return et.call(s)}function ui(s){if(!nt(s)||bi(s))return!1;var u=se(s)||jt(s)?be:fe;return u.test(N(s))}function gi(s){if(!te(s))return Fe(s);var u=[];for(var p in Object(s))j.call(s,p)&&p!="constructor"&&u.push(p);return u}function pi(s,u){if(u)return s.slice();var p=new s.constructor(s.length);return s.copy(p),p}function Pt(s){var u=new s.constructor(s.byteLength);return new Xt(u).set(new Xt(s)),u}function di(s,u){var p=u?Pt(s.buffer):s.buffer;return new s.constructor(p,s.byteOffset,s.byteLength)}function fi(s,u,p){var y=u?p(Bt(s),!0):Bt(s);return Ht(y,ve,new s.constructor)}function Pi(s){var u=new s.constructor(s.source,de.exec(s));return u.lastIndex=s.lastIndex,u}function mi(s,u,p){var y=u?p(Ut(s),!0):Ut(s);return Ht(y,Me,new s.constructor)}function yi(s){return $t?Object($t.call(s)):{}}function wi(s,u){var p=u?Pt(s.buffer):s.buffer;return new s.constructor(p,s.byteOffset,s.length)}function vi(s,u){var p=-1,y=s.length;for(u||(u=Array(y));++p<y;)u[p]=s[p];return u}function Qt(s,u,p,y){p||(p={});for(var E=-1,G=u.length;++E<G;){var R=u[E],D=void 0;Jt(p,R,D===void 0?s[R]:D)}return p}function Mi(s,u){return Qt(s,Zt(s),u)}function Ci(s){return ci(s,yt,Zt)}function st(s,u){var p=s.__data__;return Ei(u)?p[typeof u=="string"?"string":"hash"]:p.map}function X(s,u){var p=Le(s,u);return ui(p)?p:void 0}var Zt=Yt?ct(Yt,Object):xi,V=li;(ut&&V(new ut(new ArrayBuffer(1)))!=I||J&&V(new J)!=P||gt&&V(gt.resolve())!=v||pt&&V(new pt)!=C||dt&&V(new dt)!=k)&&(V=function(s){var u=et.call(s),p=u==m?s.constructor:void 0,y=p?N(p):void 0;if(y)switch(y){case xe:return I;case We:return P;case Oe:return v;case Re:return C;case He:return k}return u});function Ti(s){var u=s.length,p=s.constructor(u);return u&&typeof s[0]=="string"&&j.call(s,"index")&&(p.index=s.index,p.input=s.input),p}function Si(s){return typeof s.constructor=="function"&&!te(s)?hi(_e(s)):{}}function Li(s,u,p,y){var E=s.constructor;switch(u){case _:return Pt(s);case a:case l:return new E(+s);case I:return di(s,y);case $:case _t:case Gt:case Dt:case kt:case It:case Ft:case xt:case Wt:return wi(s,y);case P:return fi(s,y,p);case d:case L:return new E(s);case M:return Pi(s);case C:return mi(s,y,p);case b:return yi(s)}}function Ai(s,u){return u=u??o,!!u&&(typeof s=="number"||Pe.test(s))&&s>-1&&s%1==0&&s<u}function Ei(s){var u=typeof s;return u=="string"||u=="number"||u=="symbol"||u=="boolean"?s!=="__proto__":s===null}function bi(s){return!!Vt&&Vt in s}function te(s){var u=s&&s.constructor,p=typeof u=="function"&&u.prototype||tt;return s===p}function N(s){if(s!=null){try{return Nt.call(s)}catch{}try{return s+""}catch{}}return""}function _i(s){return ft(s,!0,!0)}function ee(s,u){return s===u||s!==s&&u!==u}function Gi(s){return Di(s)&&j.call(s,"callee")&&(!De.call(s,"callee")||et.call(s)==n)}var mt=Array.isArray;function ie(s){return s!=null&&Ii(s.length)&&!se(s)}function Di(s){return Fi(s)&&ie(s)}var ki=Ie||Wi;function se(s){var u=nt(s)?et.call(s):"";return u==g||u==f}function Ii(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=o}function nt(s){var u=typeof s;return!!s&&(u=="object"||u=="function")}function Fi(s){return!!s&&typeof s=="object"}function yt(s){return ie(s)?ri(s):gi(s)}function xi(){return[]}function Wi(){return!1}c.exports=_i})(at,at.exports);var Hi=at.exports;const ji=Oi(Hi),he=100,Tt=1e-4,S=(c,t)=>Math.sqrt((c[0]-t[0])**2+(c[1]-t[1])**2),ht=c=>{let t=0;return c&&Array.isArray(c)&&c.length>0&&c.forEach((e,i)=>{i<c.length-1&&(t+=S(e,c[i+1]))}),t},x=c=>ht(c)**.99,F=(c,t)=>[(c[0]+t[0])/2,(c[1]+t[1])/2],le=(c,t,e)=>{const i=[(c[0]+t[0])/2,(c[1]+t[1])/2],o=[i[0]-c[1]+t[1],i[1]+c[0]-t[0]],n=[(c[0]+e[0])/2,(c[1]+e[1])/2],r=[n[0]-c[1]+e[1],n[1]+c[0]-e[0]];return Bi(i,o,n,r)},Bi=(c,t,e,i)=>{if(c[1]===t[1]){const h=(i[0]-e[0])/(i[1]-e[1])*(c[1]-e[1])+e[0],g=c[1];return[h,g]}if(e[1]===i[1]){const h=(t[0]-c[0])/(t[1]-c[1])*(e[1]-c[1])+c[0],g=e[1];return[h,g]}const o=(t[0]-c[0])/(t[1]-c[1]),n=(i[0]-e[0])/(i[1]-e[1]),r=(o*c[1]-c[0]-n*e[1]+e[0])/(o-n);return[o*r-o*c[1]+c[0],r]},H=(c,t)=>{let e;const i=Math.asin(Math.abs(t[1]-c[1])/S(c,t));return t[1]>=c[1]&&t[0]>=c[0]?e=i+Math.PI:t[1]>=c[1]&&t[0]<c[0]?e=Math.PI*2-i:t[1]<c[1]&&t[0]<c[0]?e=i:t[1]<c[1]&&t[0]>=c[0]&&(e=Math.PI-i),e},Ct=(c,t,e)=>{const i=H(t,c)-H(t,e);return i<0?i+Math.PI*2:i},K=(c,t,e)=>(e[1]-c[1])*(t[0]-c[0])>(t[1]-c[1])*(e[0]-c[0]),St=(c,t,e,i,o)=>{c=Math.max(Math.min(c,1),0);const[n,r]=[1-c,c*c],a=r*c,l=n*n,h=l*n,g=h*t[0]+3*l*c*e[0]+3*n*r*i[0]+a*o[0],f=h*t[1]+3*l*c*e[1]+3*n*r*i[1]+a*o[1];return[g,f]},w=(c,t,e,i,o)=>{const n=H(c,t),r=o?n+e:n-e,a=i*Math.cos(r),l=i*Math.sin(r);return[t[0]+a,t[1]+l]},Lt=(c,t,e,i)=>{let[o,n,r,a]=[null,null,[],i-e];a=a<0?a+Math.PI*2:a;for(let l=0;l<=100;l++){const h=e+a*l/100;o=c[0]+t*Math.cos(h),n=c[1]+t*Math.sin(h),r.push([o,n])}return r},Z=(c,t,e,i)=>{const o=At(t,e,i);let[n,r,a,l,h]=[null,null,null,null,null];const g=Math.sqrt(o[0]*o[0]+o[1]*o[1]),f=o[0]/g,P=o[1]/g,d=S(t,e),m=S(e,i);return g>Tt?K(t,e,i)?(a=c*d,l=e[0]-a*P,h=e[1]+a*f,n=[l,h],a=c*m,l=e[0]+a*P,h=e[1]-a*f,r=[l,h]):(a=c*d,l=e[0]+a*P,h=e[1]-a*f,n=[l,h],a=c*m,l=e[0]-a*P,h=e[1]+a*f,r=[l,h]):(l=e[0]+c*(t[0]-e[0]),h=e[1]+c*(t[1]-e[1]),n=[l,h],l=e[0]+c*(i[0]-e[0]),h=e[1]+c*(i[1]-e[1]),r=[l,h]),[n,r]},At=(c,t,e)=>{let i=c[0]-t[0],o=c[1]-t[1];const n=Math.sqrt(i*i+o*o);i/=n,o/=n;let r=e[0]-t[0],a=e[1]-t[1];const l=Math.sqrt(r*r+a*a);r/=l,a/=l;const h=i+r,g=o+a;return[h,g]},Ui=(c,t)=>{let[e,i,o,n,r]=[c[0],c[1],c[2],null,null];const l=Z(0,e,i,o)[0],h=At(e,i,o);if(Math.sqrt(h[0]*h[0]+h[1]*h[1])>Tt){const f=F(e,i),P=e[0]-f[0],d=e[1]-f[1],v=2/S(e,i),M=-v*d,C=v*P,L=M*M-C*C,b=2*M*C,k=C*C-M*M,_=l[0]-f[0],I=l[1]-f[1];n=f[0]+L*_+b*I,r=f[1]+b*_+k*I}else n=e[0]+t*(i[0]-e[0]),r=e[1]+t*(i[1]-e[1]);return[n,r]},Vi=(c,t)=>{const e=c.length,i=c[e-3],o=c[e-2],n=c[e-1],a=Z(0,i,o,n)[1],l=At(i,o,n),h=Math.sqrt(l[0]*l[0]+l[1]*l[1]);let[g,f]=[null,null];if(h>Tt){const P=F(o,n),d=n[0]-P[0],m=n[1]-P[1],M=2/S(o,n),C=-M*m,L=M*d,b=C*C-L*L,k=2*C*L,_=L*L-C*C,I=a[0]-P[0],$=a[1]-P[1];g=P[0]+b*I+k*$,f=P[1]+k*I+_*$}else g=n[0]+t*(o[0]-n[0]),f=n[1]+t*(o[1]-n[1]);return[g,f]},Et=(c,t)=>{const e=Ui(t,c);let[i,o,n,r,a]=[null,null,null,[e],[]];for(let h=0;h<t.length-2;h++){[i,o,n]=[t[h],t[h+1],t[h+2]];const g=Z(c,i,o,n);r=r.concat(g)}const l=Vi(t,c);l&&r.push(l);for(let h=0;h<t.length-1;h++){i=t[h],o=t[h+1],a.push(i);for(let g=0;g<he;g++){const f=St(g/he,i,r[h*2],r[h*2+1],o);a.push(f)}a.push(o)}return a},vt=function(c){if(c.length<=2)return c;const t=[],e=c.length-1;for(let i=0;i<=1;i+=.01){let[o,n]=[0,0];for(let r=0;r<=e;r++){const a=Ni(e,r),l=i**r,h=(1-i)**(e-r);o+=a*l*h*c[r][0],n+=a*l*h*c[r][1]}t.push([o,n])}return t.push(c[e]),t},Mt=c=>{let t=1;switch(c){case c<=1:t=1;break;case c===2:t=2;break;case c===3:t=6;break;case c===24:t=24;break;case c===5:t=120;break;default:for(let e=1;e<=c;e++)t*=e;break}return t},Ni=(c,t)=>Mt(c)/(Mt(t)*Mt(c-t)),B=c=>{if(c.length<=2)return c;const[t,e]=[2,[]],i=c.length-t-1;e.push(c[0]);for(let o=0;o<=i;o++)for(let n=0;n<=1;n+=.05){let[r,a]=[0,0];for(let l=0;l<=t;l++){const h=zi(l,n);r+=h*c[o+l][0],a+=h*c[o+l][1]}e.push([r,a])}return e.push(c[c.length-1]),e},zi=(c,t)=>{let e=0;return c===0?e=(t-1)**2/2:c===1?e=(-2*t**2+2*t+1)/2:c===2&&(e=t**2/2),e};class A{constructor(t,e,i){this.geometryPoints=[],this.state="drawing",this.controlPoints=[],this.entityId="",this.points=[],this.minPointsForShape=0,this.cesium=t,this.viewer=e,this.type=this.getType(),this.mergeStyle(i),this.cartesianToLnglat=this.cartesianToLnglat.bind(this),this.pixelToCartesian=this.pixelToCartesian.bind(this),this.eventDispatcher=new Ri,e.trackedEntity=void 0,e.cesiumWidget.screenSpaceEventHandler.removeInputAction(this.cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.onClick()}mergeStyle(t){this.type==="polygon"?this.style=Object.assign({material:new this.cesium.Color,outlineMaterial:new this.cesium.Color,outlineWidth:2},t):this.type==="line"?this.style=Object.assign({material:new this.cesium.Color,lineWidth:2},t):this.type==="point"&&(this.style=Object.assign({pixelSize:10,heightReference:this.cesium.HeightReference.CLAMP_TO_GROUND,color:this.cesium.Color.RED},t)),this.styleCache=ji(this.style)}setState(t){this.state=t}getState(){return this.state}onClick(){this.eventHandler=new this.cesium.ScreenSpaceEventHandler(this.viewer.canvas),this.eventHandler.setInputAction(t=>{const e=this.viewer.scene.pick(t.position),i=this.cesium.defined(e)&&e.id instanceof this.cesium.Entity;let o=this.polygonEntity;if(this.type==="line"&&(o=this.lineEntity),this.type==="point"&&(o=this.pointEntity),this.state==="drawing"){const n=this.pixelToCartesian(t.position),r=this.getPoints();if(!n||!this.freehand&&r.length>0&&!this.checkDistance(n,r[r.length-1]))return;this.addPoint(n),this.getPoints().length===1&&this.eventDispatcher.dispatchEvent("drawStart"),this.eventDispatcher.dispatchEvent("drawUpdate",n)}else if(this.state==="edit")(!i||o.id!==e.id.id)&&(this.setState("static"),this.type!=="point"&&this.removeControlPoints(),this.disableDrag(),this.eventDispatcher.dispatchEvent("editEnd",this.getPoints()));else if(this.state==="static")try{if(i&&o.id===e.id.id){const n=this.type==="line"?e.id.polyline:this.type==="polygon"?e.id.polygon:e.id.point;this.cesium.defined(n)&&(this.setState("edit"),this.type!=="point"&&this.addControlPoints(),this.draggable(),this.eventDispatcher.dispatchEvent("editStart"))}}catch(n){console.log("eeee",n)}},this.cesium.ScreenSpaceEventType.LEFT_CLICK)}onMouseMove(){this.eventHandler.setInputAction(t=>{const e=this.getPoints(),i=this.pixelToCartesian(t.endPosition);i&&this.checkDistance(i,e[e.length-1])&&this.updateMovingPoint(i,e.length)},this.cesium.ScreenSpaceEventType.MOUSE_MOVE)}onDoubleClick(){this.eventHandler.setInputAction(t=>{this.state==="drawing"&&this.finishDrawing()},this.cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}checkDistance(t,e){return this.cesium.Cartesian3.distance(t,e)>10}finishDrawing(){this.type==="polygon"&&this.lineEntity&&this.viewer.entities.remove(this.lineEntity),this.removeMoveListener(),this.setState("edit"),this.type!=="point"&&this.addControlPoints(),this.draggable();const t=this.polygonEntity||this.lineEntity||this.pointEntity;this.entityId=t.id,this.eventDispatcher.dispatchEvent("drawEnd",this.getPoints())}removeClickListener(){this.eventHandler.removeInputAction(this.cesium.ScreenSpaceEventType.LEFT_CLICK)}removeMoveListener(){this.eventHandler.removeInputAction(this.cesium.ScreenSpaceEventType.MOUSE_MOVE)}removeDoubleClickListener(){this.eventHandler.removeInputAction(this.cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}setGeometryPoints(t){this.geometryPoints=t}getGeometryPoints(){return this.geometryPoints}drawPolygon(){const t=()=>new this.cesium.PolygonHierarchy(this.geometryPoints);if(!this.polygonEntity){const e=this.style;this.polygonEntity=this.viewer.entities.add({polygon:new this.cesium.PolygonGraphics({hierarchy:new this.cesium.CallbackProperty(t,!1),show:!0,material:e.material})}),this.outlineEntity=this.viewer.entities.add({polyline:{positions:new this.cesium.CallbackProperty(()=>[...this.geometryPoints,this.geometryPoints[0]],!1),width:e.outlineWidth,material:e.outlineMaterial,clampToGround:!0}})}}drawLine(){if(!this.lineEntity){const t=this.style;this.lineEntity=this.addLineEntity(t)}}drawPoint(){if(!this.pointEntity){const t=this.getPoints(),e=this.style;this.pointEntity=this.viewer.entities.add({position:t[0],point:{pixelSize:e.pixelSize,heightReference:e.heightReference,color:e.color}})}}addTempLine(){if(!this.tempLineEntity){const t=this.style,e={material:t.outlineMaterial,lineWidth:t.outlineWidth};this.tempLineEntity=this.addLineEntity(e)}}removeTempLine(){this.tempLineEntity&&this.viewer.entities.remove(this.tempLineEntity)}addLineEntity(t){return this.viewer.entities.add({polyline:{positions:new this.cesium.CallbackProperty(()=>this.geometryPoints,!1),width:t.lineWidth,material:t.material,clampToGround:!0}})}cartesianToLnglat(t){const e=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(t),i=this.cesium.Math.toDegrees(e.latitude);return[this.cesium.Math.toDegrees(e.longitude),i]}pixelToCartesian(t){const e=this.viewer.camera.getPickRay(t);return this.viewer.scene.globe.pick(e,this.viewer.scene)}addControlPoints(){const t=this.getPoints();this.controlPoints=t.map(n=>this.viewer.entities.add({position:n,point:{pixelSize:10,heightReference:this.cesium.HeightReference.CLAMP_TO_GROUND,color:this.cesium.Color.RED}}));let e=!1,i=null,o;this.controlPointsEventHandler=new this.cesium.ScreenSpaceEventHandler(this.viewer.canvas),this.controlPointsEventHandler.setInputAction(n=>{const r=this.viewer.scene.pick(n.position);if(this.cesium.defined(r)){for(let a=0;a<this.controlPoints.length;a++)if(r.id._id===this.controlPoints[a]._id){e=!0,i=this.controlPoints[a],o=i.position._value,i.index=a;break}this.viewer.scene.screenSpaceCameraController.enableRotate=!1}},this.cesium.ScreenSpaceEventType.LEFT_DOWN),this.controlPointsEventHandler.setInputAction(n=>{if(e&&i){const r=this.viewer.camera.pickEllipsoid(n.endPosition,this.viewer.scene.globe.ellipsoid);r&&(i.position.setValue(r),this.updateDraggingPoint(r,i.index))}},this.cesium.ScreenSpaceEventType.MOUSE_MOVE),this.controlPointsEventHandler.setInputAction(()=>{i&&!this.cesium.Cartesian3.equals(o,i.position._value)&&this.eventDispatcher.dispatchEvent("drawUpdate",i.position._value),e=!1,i=null,this.viewer.scene.screenSpaceCameraController.enableRotate=!0},this.cesium.ScreenSpaceEventType.LEFT_UP)}removeControlPoints(){this.controlPoints.length>0&&(this.controlPoints.forEach(t=>{this.viewer.entities.remove(t)}),this.controlPointsEventHandler.removeInputAction(this.cesium.ScreenSpaceEventType.LEFT_DOWN),this.controlPointsEventHandler.removeInputAction(this.cesium.ScreenSpaceEventType.MOUSE_MOVE),this.controlPointsEventHandler.removeInputAction(this.cesium.ScreenSpaceEventType.LEFT_UP))}draggable(){let t=!1,e;this.dragEventHandler=new this.cesium.ScreenSpaceEventHandler(this.viewer.canvas),this.dragEventHandler.setInputAction(i=>{const o=this.viewer.scene.camera.getPickRay(i.position);if(o){const n=this.viewer.scene.globe.pick(o,this.viewer.scene),r=this.viewer.scene.pick(i.position);if(this.cesium.defined(r)&&r.id instanceof this.cesium.Entity){const a=r.id;this.isCurrentEntity(a.id)&&(t=!0,e=n,this.viewer.scene.screenSpaceCameraController.enableRotate=!1)}}},this.cesium.ScreenSpaceEventType.LEFT_DOWN),this.dragEventHandler.setInputAction(i=>{var o,n;if(t&&e){const r=this.pixelToCartesian(i.endPosition);if(r){const a=this.cesium.Cartesian3.subtract(r,e,new this.cesium.Cartesian3);if(this.type==="point"){const h=(o=this.pointEntity.position)==null?void 0:o.getValue(this.cesium.JulianDate.now()),g=this.cesium.Cartesian3.add(h,a,new this.cesium.Cartesian3);(n=this.pointEntity.position)==null||n.setValue(g)}const l=this.geometryPoints.map(h=>this.cesium.Cartesian3.add(h,a,new this.cesium.Cartesian3));this.points=this.points.map(h=>this.cesium.Cartesian3.add(h,a,new this.cesium.Cartesian3)),this.controlPoints.map(h=>{var g,f;const P=(g=h.position)==null?void 0:g.getValue(this.cesium.JulianDate.now()),d=this.cesium.Cartesian3.add(P,a,new this.cesium.Cartesian3);(f=h.position)==null||f.setValue(d)}),this.setGeometryPoints(l),this.minPointsForShape===4&&(this.curveControlPointLeft=this.cesium.Cartesian3.add(this.curveControlPointLeft,a,new this.cesium.Cartesian3),this.curveControlPointRight=this.cesium.Cartesian3.add(this.curveControlPointRight,a,new this.cesium.Cartesian3)),e=r}}else if(this.viewer.scene.camera.getPickRay(i.endPosition)){const a=this.viewer.scene.pick(i.endPosition);if(this.cesium.defined(a)&&a.id instanceof this.cesium.Entity){const l=a.id;this.isCurrentEntity(l.id)?this.viewer.scene.canvas.style.cursor="move":this.viewer.scene.canvas.style.cursor="default"}else this.viewer.scene.canvas.style.cursor="default"}},this.cesium.ScreenSpaceEventType.MOUSE_MOVE),this.dragEventHandler.setInputAction(()=>{t=!1,e=void 0,this.viewer.scene.screenSpaceCameraController.enableRotate=!0},this.cesium.ScreenSpaceEventType.LEFT_UP)}disableDrag(){this.dragEventHandler.removeInputAction(this.cesium.ScreenSpaceEventType.LEFT_DOWN),this.dragEventHandler.removeInputAction(this.cesium.ScreenSpaceEventType.MOUSE_MOVE),this.dragEventHandler.removeInputAction(this.cesium.ScreenSpaceEventType.LEFT_UP)}show(t){if(t){const{duration:e,delay:i,callback:o}=t;this.showWithAnimation(e,i,o);return}else this.showWithAnimation(0,0)}hide(t){if(t){const{duration:e,delay:i,callback:o}=t;this.hideWithAnimation(e,i,o);return}else this.hideWithAnimation(0,0)}showWithAnimation(t=2e3,e=0,i){var o,n,r,a;if(this.state==="hidden"){if(this.setState("static"),this.type==="polygon"){let l=.3;const h=this.styleCache.material;h.image?l=h.color.getValue().alpha:l=h.alpha,this.animateOpacity(this.polygonEntity,l,t,e,i,this.state);const g=(n=(o=this.styleCache)==null?void 0:o.outlineMaterial)==null?void 0:n.alpha;this.animateOpacity(this.outlineEntity,g||1,t,e,void 0,this.state)}else if(this.type==="line"){const l=this.styleCache.material;let h=1;l.image?h=l.color.alpha:l.dashLength?h=l.color.getValue().alpha:h=(a=(r=this.styleCache)==null?void 0:r.material)==null?void 0:a.alpha,this.animateOpacity(this.lineEntity,h,t,e,i,this.state)}t!=0&&this.setState("animating")}}hideWithAnimation(t=2e3,e=0,i){this.state==="hidden"||this.state!="static"||(this.setState("hidden"),this.type==="polygon"?(this.animateOpacity(this.polygonEntity,0,t,e,i,this.state),this.animateOpacity(this.outlineEntity,0,t,e,void 0,this.state)):this.type==="line"&&this.animateOpacity(this.lineEntity,0,t,e,i,this.state),t!=0&&this.setState("animating"))}animateOpacity(t,e,i,o,n,r){setTimeout(()=>{const a=t.polygon||t.polyline||t.billboard;let l,h=a.material;h?h.image&&h.color.alpha!==void 0?l=h.color.alpha:l=h.color.getValue().alpha:l=a.color.getValue().alpha;let g=0;const f=P=>{g||(g=P);const d=P-g;if(d<i){const m=d/i*(e-l),v=l+m;if(h)if(h.image&&h.color.alpha!==void 0)h.color.alpha=v;else{const M=h.color.getValue().withAlpha(v);h.color.setValue(M)}else{const C=a.color.getValue().withAlpha(v);a.color.setValue(C)}requestAnimationFrame(f)}else{n&&n();const m=r||"static";if(h)if(h.image&&h.color.alpha!==void 0)h.color.alpha=e;else{const v=h.color.getValue().withAlpha(e);h.color.setValue(v)}else{const M=a.color.getValue().withAlpha(e);a.color.setValue(M)}requestAnimationFrame(()=>{this.setState(m)})}};requestAnimationFrame(f)},o)}startGrowthAnimation(t){const{duration:e=2e3,delay:i=0,callback:o}=t||{};if(!(this.state==="hidden"||this.state!="static")){if(!this.minPointsForShape){console.warn("Growth animation is not supported for this type of shape");return}if(this.setState("animating"),this.minPointsForShape===4){this.doubleArrowGrowthAnimation(e,i,o);return}setTimeout(()=>{this.hideWithAnimation(0,0,void 0);const n=this.getPoints();let r=0;this.minPointsForShape===2?r=e/(n.length-1):r=e/(n.length-2);let a=Date.now(),l=0;this.viewer.clock.shouldAnimate=!0;const h=g=>{const P=Date.now()-a;if(P>=e){o&&o(),a=0,this.viewer.clock.shouldAnimate=!1,this.viewer.clock.onTick.removeEventListener(h),this.setState("static");return}const d=Math.floor(P/r);let m;this.minPointsForShape===2?l=d+1:l=d+2,m=n[l-1],d==0&&this.minPointsForShape===3&&(m=this.cesium.Cartesian3.midpoint(n[0],n[1],new this.cesium.Cartesian3));let v=n[l];const M=(P-d*r)/r,C=this.cesium.Cartesian3.lerp(m,v,M,new this.cesium.Cartesian3),L=n.slice(0,l+1);L[L.length-1]=C;const b=this.createGraphic(L);this.setGeometryPoints(b),this.showWithAnimation(0,0,void 0)};this.viewer.clock.onTick.addEventListener(h)},i)}}doubleArrowGrowthAnimation(t=2e3,e=0,i){setTimeout(()=>{this.hideWithAnimation(0,0,void 0);const o=this.getPoints();let n=Date.now();this.viewer.clock.shouldAnimate=!0;const r=a=>{const h=Date.now()-n;if(h>=t){i&&i(),n=0,this.viewer.clock.shouldAnimate=!1,this.viewer.clock.onTick.removeEventListener(r),this.setState("static");return}const g=this.cesium.Cartesian3.midpoint(o[0],o[1],new this.cesium.Cartesian3),f=this.cesium.Cartesian3.midpoint(o[0],g,new this.cesium.Cartesian3),P=this.cesium.Cartesian3.midpoint(g,o[1],new this.cesium.Cartesian3);let d=o[3],m=o[2];const v=h/t,M=this.getBezierControlPointforGrowthAnimation();let C=[f,M.left,d],L=[P,M.right,m];const b=this.getNewPosition(C,v),k=this.getNewPosition(L,v),_=[...o];_[2]=k,_[3]=b;const I=this.createGraphic(_);this.setGeometryPoints(I),this.showWithAnimation(0,0,void 0)};this.viewer.clock.onTick.addEventListener(r)},e)}getNewPosition(t,e){t=t.map(n=>this.cartesianToLnglat(n));let i=Et(.3,t);return i=i.map(n=>this.cesium.Cartesian3.fromDegrees(n[0],n[1])),this.interpolateAlongCurve(i,e)}interpolateAlongCurve(t,e){const i=t.length-1,o=Math.floor(e*i),n=e*i-o,r=t[o],a=t[o+1],l=r.x+(a.x-r.x)*n,h=r.y+(a.y-r.y)*n,g=r.z+(a.z-r.z)*n;return new this.cesium.Cartesian3(l,h,g)}remove(){this.type==="polygon"?(this.viewer.entities.remove(this.polygonEntity),this.viewer.entities.remove(this.outlineEntity),this.polygonEntity=null,this.outlineEntity=null,this.lineEntity=null):this.type==="line"?this.viewer.entities.remove(this.lineEntity):this.type==="point"&&this.viewer.entities.remove(this.pointEntity),this.removeClickListener(),this.removeMoveListener(),this.removeDoubleClickListener(),this.removeControlPoints()}on(t,e){this.eventDispatcher.on(t,e)}off(t,e){this.eventDispatcher.off(t,e)}isCurrentEntity(t){return this.entityId===t}addPoint(t){}getPoints(){return[new this.cesium.Cartesian3]}updateMovingPoint(t,e){}updateDraggingPoint(t,e){}getType(){return"polygon"}createGraphic(t){return t}}class ue extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.arrowLengthScale=5,this.maxArrowLength=2,this.cesium=t,this.tailWidthFactor=.1,this.neckWidthFactor=.2,this.headWidthFactor=.25,this.headAngle=Math.PI/8.5,this.neckAngle=Math.PI/13,this.minPointsForShape=2,this.setState("drawing")}getType(){return"polygon"}addPoint(t){if(this.points.length<2&&(this.points.push(t),this.onMouseMove()),this.points.length===2){const e=this.createGraphic(this.points);this.setGeometryPoints(e),this.drawPolygon(),this.finishDrawing()}}updateMovingPoint(t){const e=[...this.points,t],i=this.createGraphic(e);this.setGeometryPoints(i),this.drawPolygon()}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawPolygon()}createGraphic(t){const[e,i]=t.map(this.cartesianToLnglat),o=x([e,i]),n=o*this.tailWidthFactor,r=o*this.neckWidthFactor,a=o*this.headWidthFactor,l=w(i,e,Math.PI/2,n,!0),h=w(i,e,Math.PI/2,n,!1),g=w(e,i,this.headAngle,a,!1),f=w(e,i,this.headAngle,a,!0),P=w(e,i,this.neckAngle,r,!1),d=w(e,i,this.neckAngle,r,!0),m=[...l,...P,...g,...i,...f,...d,...h,...e];return this.cesium.Cartesian3.fromDegreesArray(m)}getPoints(){return this.points}}class bt extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.headTailFactor=.8,this.minPointsForShape=3,this.setState("drawing"),this.onDoubleClick()}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length<2?this.onMouseMove():this.points.length===2&&(this.setGeometryPoints(this.points),this.drawPolygon())}updateMovingPoint(t){const e=[...this.points,t];if(this.setGeometryPoints(e),e.length===2)this.addTempLine();else{this.removeTempLine();const i=this.createGraphic(e);this.setGeometryPoints(i),this.drawPolygon()}}createGraphic(t){const e=t.map(L=>this.cartesianToLnglat(L));let[i,o]=[e[0],e[1]];K(e[0],e[1],e[2])&&(i=e[1],o=e[0]);const r=[F(i,o)].concat(e.slice(2)),a=this.getArrowHeadPoints(r,i,o),[l,h]=[a[0],a[4]],g=S(i,o)/x(r),f=this.getArrowBodyPoints(r,l,h,g),P=f.length;let d=[i].concat(f.slice(0,P/2));d.push(l);let m=[o].concat(f.slice(P/2,P));m.push(h),d=B(d),m=B(m);const v=d.concat(a,m.reverse()),M=[].concat(...v);return this.cesium.Cartesian3.fromDegreesArray(M)}getPoints(){return this.points}getArrowHeadPoints(t,e,i){try{let o=x(t),n=o*this.headHeightFactor;const r=t[t.length-1];o=S(r,t[t.length-2]);const a=S(e,i);n>a*this.headTailFactor&&(n=a*this.headTailFactor);const l=n*this.headWidthFactor,h=n*this.neckWidthFactor;n=n>o?o:n;const g=n*this.neckHeightFactor,f=w(t[t.length-2],r,0,n,!0),P=w(t[t.length-2],r,0,g,!0),d=w(r,f,Math.PI/2,l,!1),m=w(r,f,Math.PI/2,l,!0),v=w(r,P,Math.PI/2,h,!1),M=w(r,P,Math.PI/2,h,!0);return[v,d,r,m,M]}catch(o){console.log(o)}}getArrowBodyPoints(t,e,i,o){const n=ht(t),a=x(t)*o,l=S(e,i),h=(a-l)/2;let[g,f,P]=[0,[],[]];for(let d=1;d<t.length-1;d++){const m=Ct(t[d-1],t[d],t[d+1])/2;g+=S(t[d-1],t[d]);const v=(a/2-g/n*h)/Math.sin(m),M=w(t[d-1],t[d],Math.PI-m,v,!0),C=w(t[d-1],t[d],m,v,!1);f.push(M),P.push(C)}return f.concat(P)}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawPolygon()}}class qi extends bt{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.headTailFactor=.8,this.swallowTailFactor=1,this.swallowTailPnt=[0,0],this.minPointsForShape=3}createGraphic(t){const e=t.map(_=>this.cartesianToLnglat(_));let[i,o]=[e[0],e[1]];K(e[0],e[1],e[2])&&(i=e[1],o=e[0]);const r=[F(i,o)].concat(e.slice(2)),a=this.getArrowHeadPoints(r,i,o),[l,h]=[a[0],a[4]],g=S(i,o),f=x(r),P=f*this.tailWidthFactor*this.swallowTailFactor;this.swallowTailPnt=w(r[1],r[0],0,P,!0);const d=g/f,m=this.getArrowBodyPoints(r,l,h,d),v=m.length;let M=[i].concat(m.slice(0,v/2));M.push(l);let C=[o].concat(m.slice(v/2,v));C.push(h),M=B(M),C=B(C);const L=M.concat(a,C.reverse(),[this.swallowTailPnt,M[0]]),b=[].concat(...L);return this.cesium.Cartesian3.fromDegreesArray(b)}}class ge extends bt{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.minPointsForShape=2}addPoint(t){this.points.push(t),this.points.length<2?this.onMouseMove():this.points.length>2&&this.lineEntity&&this.viewer.entities.remove(this.lineEntity)}updateMovingPoint(t){const e=[...this.points,t];if(this.setGeometryPoints(e),!(e.length<2)){const i=this.createGraphic(e);this.setGeometryPoints(i),this.drawPolygon()}}createGraphic(t){const e=t.map(m=>this.cartesianToLnglat(m)),i=this.getTailPoints(e),o=this.getArrowHeadPoints(e,i[0],i[1]),n=o[0],r=o[4],a=this.getArrowBodyPoints(e,n,r,this.tailWidthFactor),l=a.length;let h=[i[0]].concat(a.slice(0,l/2));h.push(n);let g=[i[1]].concat(a.slice(l/2,l));g.push(r),h=B(h),g=B(g);const f=h.concat(o,g.reverse()),P=[].concat(...f);return this.cesium.Cartesian3.fromDegreesArray(P)}getTailPoints(t){const i=x(t)*this.tailWidthFactor,o=w(t[1],t[0],Math.PI/2,i,!1),n=w(t[1],t[0],Math.PI/2,i,!0);return[o,n]}}class Xi extends ge{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.swallowTailFactor=1,this.minPointsForShape=2}createGraphic(t){const e=t.map(m=>this.cartesianToLnglat(m)),i=this.getTailPoints(e),o=this.getArrowHeadPoints(e,i[0],i[2]),n=o[0],r=o[4],a=this.getArrowBodyPoints(e,n,r,this.tailWidthFactor),l=a.length;let h=[i[0]].concat(a.slice(0,l/2));h.push(n);let g=[i[2]].concat(a.slice(l/2,l));g.push(r),h=B(h),g=B(g);const f=h.concat(o,g.reverse(),[i[1],h[0]]),P=[].concat(...f);return this.cesium.Cartesian3.fromDegreesArray(P)}getTailPoints(t){const i=x(t)*this.tailWidthFactor,o=w(t[1],t[0],Math.PI/2,i,!1),n=w(t[1],t[0],Math.PI/2,i,!0),r=i*this.swallowTailFactor,a=w(t[1],t[0],0,r,!0);return[o,a,n]}}class Yi extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.arrowLengthScale=5,this.maxArrowLength=3e6,this.cesium=t,this.minPointsForShape=2,this.setState("drawing")}getType(){return"line"}addPoint(t){if(this.points.length<2&&(this.points.push(t),this.onMouseMove()),this.points.length===2){const e=this.createGraphic(this.points);this.setGeometryPoints(e),this.drawLine(),this.finishDrawing()}}updateMovingPoint(t){const e=[...this.points,t],i=this.createGraphic(e);this.setGeometryPoints(i),this.drawLine()}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawLine()}createGraphic(t){const[e,i]=t.map(this.cartesianToLnglat);let n=S(e,i)/this.arrowLengthScale;n=n>this.maxArrowLength?this.maxArrowLength:n;const r=w(e,i,Math.PI/6,n/2,!1),a=w(e,i,Math.PI/6,n/2,!0),l=[...e,...i,...r,...i,...a];return this.cesium.Cartesian3.fromDegreesArray(l)}getPoints(){return this.points}}class Ki extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.arrowLengthScale=5,this.maxArrowLength=3e6,this.cesium=t,this.t=.3,this.minPointsForShape=2,this.setState("drawing"),this.onDoubleClick()}getType(){return"line"}addPoint(t){this.points.push(t),this.points.length<2&&this.onMouseMove()}updateMovingPoint(t){const e=[...this.points,t];let i=this.createGraphic(e);this.setGeometryPoints(i),this.drawLine()}createStraightArrow(t){const[e,i]=t.map(this.cartesianToLnglat);let n=S(e,i)/this.arrowLengthScale;n=n>this.maxArrowLength?this.maxArrowLength:n;const r=w(e,i,Math.PI/6,n/2,!1),a=w(e,i,Math.PI/6,n/2,!0),l=[...e,...i,...r,...i,...a];return this.cesium.Cartesian3.fromDegreesArray(l)}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawLine()}createGraphic(t){const e=t.map(P=>this.cartesianToLnglat(P));if(t.length===2)return this.createStraightArrow(t);const i=Et(this.t,e);e[e.length-2];const o=e[e.length-1];let r=ht(e)/this.arrowLengthScale;r=r>this.maxArrowLength?this.maxArrowLength:r;const a=w(i[i.length-2],i[i.length-1],Math.PI/6,r/2,!1),l=w(i[i.length-2],i[i.length-1],Math.PI/6,r/2,!0),g=[...[].concat(...i),...a,...o,...l];return this.cesium.Cartesian3.fromDegreesArray(g)}getPoints(){return this.points}}class $i extends ue{constructor(t,e,i){super(t,e,i),this.points=[],this.arrowLengthScale=5,this.maxArrowLength=2,this.cesium=t,this.tailWidthFactor=.08,this.neckWidthFactor=.1,this.headWidthFactor=.13,this.headAngle=Math.PI/4,this.neckAngle=Math.PI*.17741,this.minPointsForShape=2,this.setState("drawing")}createGraphic(t){const[e,i]=t.map(this.cartesianToLnglat),o=x([e,i])*1.5,n=o*this.tailWidthFactor,r=o*this.neckWidthFactor,a=o*this.headWidthFactor,l=w(i,e,Math.PI/2,n,!0),h=w(i,e,Math.PI/2,n,!1),g=w(e,i,this.headAngle,a,!1),f=w(e,i,this.headAngle,a,!0),P=w(e,i,this.neckAngle,r,!1),d=w(e,i,this.neckAngle,r,!0),m=[...l,...P,...g,...i,...f,...d,...h,...e];return this.cesium.Cartesian3.fromDegreesArray(m)}}class Ji extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.arrowLengthScale=5,this.maxArrowLength=2,this.llBodyPnts=[],this.rrBodyPnts=[],this.cesium=t,this.headHeightFactor=.25,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.connPoint=[0,0],this.tempPoint4=[0,0],this.minPointsForShape=4,this.setState("drawing")}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length<2?this.onMouseMove():this.points.length===2?(this.setGeometryPoints(this.points),this.drawPolygon()):this.points.length===3?this.lineEntity&&this.viewer.entities.remove(this.lineEntity):this.finishDrawing()}finishDrawing(){this.curveControlPointLeft=this.cesium.Cartesian3.fromDegrees(this.llBodyPnts[2][0],this.llBodyPnts[2][1]),this.curveControlPointRight=this.cesium.Cartesian3.fromDegrees(this.rrBodyPnts[1][0],this.rrBodyPnts[1][1]),super.finishDrawing()}updateMovingPoint(t){const e=[...this.points,t];if(this.setGeometryPoints(e),e.length===2)this.addTempLine();else if(e.length>2){this.removeTempLine();const i=this.createGraphic(e);this.setGeometryPoints(i),this.drawPolygon()}}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawPolygon()}createGraphic(t){const e=t.map(_=>this.cartesianToLnglat(_)),[i,o,n]=[e[0],e[1],e[2]],r=e.length;r===3?(this.tempPoint4=this.getTempPoint4(i,o,n),this.connPoint=F(i,o)):r===4?(this.tempPoint4=e[3],this.connPoint=F(i,o)):(this.tempPoint4=e[3],this.connPoint=e[4]);let a,l;this.isClockWise=K(i,o,n),this.isClockWise?(a=this.getArrowPoints(i,this.connPoint,this.tempPoint4,!1),l=this.getArrowPoints(this.connPoint,o,n,!0)):(a=this.getArrowPoints(o,this.connPoint,n,!1),l=this.getArrowPoints(this.connPoint,i,this.tempPoint4,!0));const h=a.length,g=(h-5)/2,f=a.slice(0,g),P=a.slice(g,g+5);let d=a.slice(g+5,h);this.llBodyPnts=f;let m=l.slice(0,g);const v=l.slice(g,g+5),M=l.slice(g+5,h);this.rrBodyPnts=M,m=vt(m);const C=vt(M.concat(f.slice(1)));d=vt(d);const L=m.concat(v,C,P,d),b=[].concat(...L);return this.cesium.Cartesian3.fromDegreesArray(b)}getTempPoint4(t,e,i){const o=F(t,e),n=S(o,i),r=Ct(t,o,i);let a=[0,0],l,h,g;return r<Math.PI/2?(l=n*Math.sin(r),h=n*Math.cos(r),g=w(t,o,Math.PI/2,l,!1),a=w(o,g,Math.PI/2,h,!0)):r>=Math.PI/2&&r<Math.PI?(l=n*Math.sin(Math.PI-r),h=n*Math.cos(Math.PI-r),g=w(t,o,Math.PI/2,l,!1),a=w(o,g,Math.PI/2,h,!1)):r>=Math.PI&&r<Math.PI*1.5?(l=n*Math.sin(r-Math.PI),h=n*Math.cos(r-Math.PI),g=w(t,o,Math.PI/2,l,!0),a=w(o,g,Math.PI/2,h,!0)):(l=n*Math.sin(Math.PI*2-r),h=n*Math.cos(Math.PI*2-r),g=w(t,o,Math.PI/2,l,!0),a=w(o,g,Math.PI/2,h,!1)),a}getArrowPoints(t,e,i,o){const n=F(t,e),r=S(n,i);let a=w(i,n,0,r*.3,!0),l=w(i,n,0,r*.5,!0);a=w(n,a,Math.PI/2,r/5,o),l=w(n,l,Math.PI/2,r/4,o);const h=[n,a,l,i],g=this.getArrowHeadPoints(h);if(g&&Array.isArray(g)&&g.length>0){const f=g[0],P=g[4],d=S(t,e)/x(h)/2,m=this.getArrowBodyPoints(h,f,P,d);if(m){const v=m.length;let M=m.slice(0,v/2),C=m.slice(v/2,v);return M.push(f),C.push(P),M=M.reverse(),M.push(e),C=C.reverse(),C.push(t),M.reverse().concat(g,C)}}else throw new Error("Interpolation Error")}getArrowBodyPoints(t,e,i,o){const n=ht(t),a=x(t)*o,l=S(e,i),h=(a-l)/2;let g=0,f=[],P=[];for(let d=1;d<t.length-1;d++){const m=Ct(t[d-1],t[d],t[d+1])/2;g+=S(t[d-1],t[d]);const v=(a/2-g/n*h)/Math.sin(m),M=w(t[d-1],t[d],Math.PI-m,v,!0),C=w(t[d-1],t[d],m,v,!1);f.push(M),P.push(C)}return f.concat(P)}getArrowHeadPoints(t){const i=x(t)*this.headHeightFactor,o=t[t.length-1],n=i*this.headWidthFactor,r=i*this.neckWidthFactor,a=i*this.neckHeightFactor,l=w(t[t.length-2],o,0,i,!0),h=w(t[t.length-2],o,0,a,!0),g=w(o,l,Math.PI/2,n,!1),f=w(o,l,Math.PI/2,n,!0),P=w(o,h,Math.PI/2,r,!1),d=w(o,h,Math.PI/2,r,!0);return[P,g,o,f,d]}getPoints(){return this.points}getBezierControlPointforGrowthAnimation(){return this.isClockWise?{left:this.curveControlPointLeft,right:this.curveControlPointRight}:{right:this.curveControlPointLeft,left:this.curveControlPointRight}}}class Qi extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.freehand=!0,this.setState("drawing")}getType(){return"line"}addPoint(t){this.points.push(t),this.points.length<2?this.onMouseMove():this.finishDrawing()}updateMovingPoint(t){this.points.push(t),this.setGeometryPoints(this.points),this.drawLine(),this.eventDispatcher.dispatchEvent("drawUpdate",t)}updateDraggingPoint(t,e){this.points[e]=t,this.setGeometryPoints(this.points),this.drawLine()}getPoints(){return this.points}}class Zi extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.freehand=!0,this.setState("drawing")}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length===1?this.onMouseMove():this.points.length>2&&this.finishDrawing()}updateMovingPoint(t){this.points.push(t),this.points.length>2&&(this.setGeometryPoints(this.points),this.drawPolygon(),this.eventDispatcher.dispatchEvent("drawUpdate",t))}updateDraggingPoint(t,e){this.points[e]=t,this.setGeometryPoints(this.points),this.drawPolygon()}getPoints(){return this.points}}class ts extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.arrowLengthScale=5,this.maxArrowLength=3e6,this.cesium=t,this.t=.3,this.setState("drawing"),this.onDoubleClick()}getType(){return"line"}addPoint(t){this.points.push(t),this.points.length<2?this.onMouseMove():this.points.length===2&&(this.setGeometryPoints(this.points),this.drawLine())}updateMovingPoint(t){const e=[...this.points,t];let i=[];e.length===2?(this.setGeometryPoints(e),this.drawLine()):(i=this.createGraphic(e),this.setGeometryPoints(i))}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawLine()}createGraphic(t){const e=t.map(r=>this.cartesianToLnglat(r)),i=Et(this.t,e),o=[].concat(...i);return this.cesium.Cartesian3.fromDegreesArray(o)}getPoints(){return this.points}}class es extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.freehand=!0,this.setState("drawing")}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length===1?this.onMouseMove():this.points.length>1&&this.finishDrawing()}updateMovingPoint(t){const e=[...this.points,t],i=this.createGraphic(e);this.setGeometryPoints(i),this.drawPolygon()}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawPolygon()}createGraphic(t){const e=t.map(f=>this.cartesianToLnglat(f)),i=e[0],o=e[1],n=F(i,o),r=Math.abs((i[0]-o[0])/2),a=Math.abs((i[1]-o[1])/2),l=this.generatePoints(n,r,a),h=[].concat(...l);return this.cesium.Cartesian3.fromDegreesArray(h)}generatePoints(t,e,i){let[o,n,r,a]=[null,null,0,[]];for(let l=0;l<=100;l++)r=Math.PI*2*l/100,o=t[0]+e*Math.cos(r),n=t[1]+i*Math.sin(r),a.push([o,n]);return a}getPoints(){return this.points}}class is extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.freehand=!0,this.setState("drawing")}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length===1?this.onMouseMove():this.points.length===2||this.points.length>2&&this.finishDrawing()}updateMovingPoint(t){const e=[...this.points,t],i=this.createGraphic(e);this.setGeometryPoints(i),this.drawPolygon()}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawPolygon()}createGraphic(t){const e=t.map(v=>this.cartesianToLnglat(v));if(e.length===2){const v=F(e[0],e[1]),M=S(e[0],v),C=w(e[0],v,Math.PI/2,M,!1);e.push(C)}let[i,o,n,r,a]=[e[0],e[1],e[2],void 0,void 0];const l=le(i,o,n),h=S(i,l),g=H(i,l),f=H(o,l);K(i,o,n)?(r=f,a=g):(r=g,a=f);let P=Lt(l,h,r,a);const d=[].concat(...P);return this.cesium.Cartesian3.fromDegreesArray(d)}getPoints(){return this.points}}class ss extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.setState("drawing")}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length===1?this.onMouseMove():this.points.length>1&&this.finishDrawing()}updateMovingPoint(t){const e=[...this.points,t],i=this.createGraphic(e);this.setGeometryPoints(i),this.drawPolygon()}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawPolygon()}createGraphic(t){const[e,i]=t.map(this.cartesianToLnglat),o=[...e,e[0],i[1],...i,i[0],e[1],...e];return this.cesium.Cartesian3.fromDegreesArray(o)}getPoints(){return this.points}}class ns extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.setState("drawing")}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length===1?this.onMouseMove():this.points.length===3&&this.finishDrawing()}updateMovingPoint(t){const e=[...this.points,t];this.setGeometryPoints(e),e.length===2?this.addTempLine():(this.removeTempLine(),this.drawPolygon())}updateDraggingPoint(t,e){this.points[e]=t,this.setGeometryPoints(this.points),this.drawPolygon()}getPoints(){return this.points}}class os extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.setState("drawing"),this.onDoubleClick()}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length===1&&this.onMouseMove()}updateMovingPoint(t){const e=[...this.points,t];this.setGeometryPoints(e),e.length===2?this.addTempLine():(this.removeTempLine(),this.drawPolygon())}updateDraggingPoint(t,e){this.points[e]=t,this.setGeometryPoints(this.points),this.drawPolygon()}getPoints(){return this.points}}class rs extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.freehand=!0,this.setState("drawing")}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length===1?this.onMouseMove():this.points.length>1&&this.finishDrawing()}updateMovingPoint(t){const e=[...this.points,t],i=this.createGraphic(e);this.setGeometryPoints(i),this.drawPolygon()}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawPolygon()}createGraphic(t){const e=t.map(h=>this.cartesianToLnglat(h)),i=e[0],o=e[1],n=S(i,o),r=this.generatePoints(i,n),a=[].concat(...r);return this.cesium.Cartesian3.fromDegreesArray(a)}generatePoints(t,e){let i,o,n;const r=[];for(let a=0;a<=100;a++)n=Math.PI*2*a/100,i=t[0]+e*Math.cos(n),o=t[1]+e*Math.sin(n),r.push([i,o]);return r}getPoints(){return this.points}}class as extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.setState("drawing")}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length===1?this.onMouseMove():this.points.length===3&&this.finishDrawing()}updateMovingPoint(t){const e=[...this.points,t];if(this.setGeometryPoints(e),e.length===2)this.addTempLine();else{this.removeTempLine();const i=this.createGraphic(e);this.setGeometryPoints(i),this.drawPolygon()}}createGraphic(t){const e=t.map(P=>this.cartesianToLnglat(P)),[i,o,n]=[e[0],e[1],e[2]],r=S(o,i),a=H(o,i),l=H(n,i),h=Lt(i,r,a,l);h.push(i,h[0]);const g=[].concat(...h);return this.cesium.Cartesian3.fromDegreesArray(g)}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawPolygon()}getPoints(){return this.points}}class hs extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.freehand=!0,this.t=.4,this.setState("drawing")}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length===1?this.onMouseMove():this.points.length===2||this.points.length>2&&this.finishDrawing()}updateMovingPoint(t){const e=[...this.points,t],i=this.createGraphic(e);this.setGeometryPoints(i),this.drawPolygon()}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawPolygon()}createGraphic(t){let e=[],i=t.map(d=>this.cartesianToLnglat(d)).slice(0);if(i.length===2){const d=F(i[0],i[1]),m=S(i[0],d),v=w(i[0],d,Math.PI/2,m,!0);i=[i[0],v,i[1]]}let o=F(i[0],i[2]);i.push(o,i[0],i[1]);let[n,r,a,l,h]=[[],void 0,void 0,void 0,[]];for(let d=0;d<i.length-2;d++){r=i[d],a=i[d+1],l=i[d+2];let m=Z(this.t,r,a,l);n=n.concat(m)}let g=n.length;n=[n[g-1]].concat(n.slice(0,g-1));for(let d=0;d<i.length-2;d++){r=i[d],a=i[d+1],h.push(r);for(let m=0;m<=40;m++){let v=St(m/40,r,n[d*2],n[d*2+1],a);h.push(v)}h.push(a)}let f=h;for(let d=0;d<f.length;d++)e=e.concat(f[d]);return Cesium.Cartesian3.fromDegreesArray(e)}getPoints(){return this.points}}class cs extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.arrowLengthScale=5,this.maxArrowLength=3e6,this.cesium=t,this.t=.3,this.setState("drawing"),this.onDoubleClick()}getType(){return"line"}addPoint(t){this.points.push(t),this.points.length<2?this.onMouseMove():this.points.length===2?(this.setGeometryPoints(this.points),this.drawLine()):this.points.length>2&&this.finishDrawing()}updateMovingPoint(t){const e=[...this.points,t];let i=[];e.length===2?(this.setGeometryPoints(e),this.drawLine()):(i=this.createGraphic(e),this.setGeometryPoints(i))}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawLine()}createGraphic(t){const e=t.map(n=>this.cartesianToLnglat(n));let i=e.length,o=[];if(!(i<2))if(i===2){for(let r=0;r<e.length;r++)o=o.concat(e[r]);return Cesium.Cartesian3.fromDegreesArray(o)}else{let[n,r,a,l,h]=[e[0],e[1],e[2],null,null],g=le(n,r,a),f=S(n,g),P=H(n,g),d=H(r,g);K(n,r,a)?(l=d,h=P):(l=P,h=d);let m=Lt(g,f,l,h);for(let M=0;M<m.length;M++)o=o.concat(m[M]);return Cesium.Cartesian3.fromDegreesArray(o)}}getPoints(){return this.points}}class ls extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.arrowLengthScale=5,this.maxArrowLength=3e6,this.cesium=t,this.t=.3,this.setState("drawing"),this.onDoubleClick()}getType(){return"line"}addPoint(t){this.points.push(t),this.points.length<2?this.onMouseMove():this.points.length===2&&(this.setGeometryPoints(this.points),this.drawLine())}updateMovingPoint(t){const e=[...this.points,t];let i=[];e.length===2?(this.setGeometryPoints(e),this.drawLine()):(i=this.createGraphic(e),this.setGeometryPoints(i))}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawLine()}createGraphic(t){const e=t.map(n=>this.cartesianToLnglat(n));let i=[];for(let n=0;n<e.length;n++)i=i.concat(e[n]);return Cesium.Cartesian3.fromDegreesArray(i)}getPoints(){return this.points}}class us extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.freehand=!0,this.t=.4,this.setState("drawing"),this.onDoubleClick()}getType(){return"polygon"}addPoint(t){this.points.push(t),this.points.length===1&&this.onMouseMove()}updateMovingPoint(t){const e=[...this.points,t],i=this.createGraphic(e);this.setGeometryPoints(i),this.drawPolygon()}updateDraggingPoint(t,e){this.points[e]=t;const i=this.createGraphic(this.points);this.setGeometryPoints(i),this.drawPolygon()}createGraphic(t){let e=[],i=t.map(o=>this.cartesianToLnglat(o));if(i.length===2){for(let n=0;n<i.length;n++)e=e.concat(i[n]);return Cesium.Cartesian3.fromDegreesArray(e)}else{let o=i.slice(0);o.push(o[0],o[1]);let[n,r]=[[],[]];for(let g=0;g<o.length-2;g++){let f=Z(this.t,o[g],o[g+1],o[g+2]);n=n.concat(f)}let a=n.length;n=[n[a-1]].concat(n.slice(0,a-1));for(let g=0;g<o.length-2;g++){let f=o[g],P=o[g+1];r.push(f);for(let d=0;d<=40;d++){let m=St(d/40,f,n[g*2],n[g*2+1],P);r.push(m)}r.push(P)}let l=r;for(let g=0;g<l.length;g++)e=e.concat(l[g]);return Cesium.Cartesian3.fromDegreesArray(e)}}getPoints(){return this.points}}class gs extends A{constructor(t,e,i){super(t,e,i),this.points=[],this.cesium=t,this.setState("drawing")}getType(){return"point"}addPoint(t){this.points.push(t),this.points.length===1&&(this.drawPoint(),this.finishDrawing())}updateMovingPoint(t){const e=[...this.points,t];this.setGeometryPoints(e)}updateDraggingPoint(t,e){this.points[e]=t,this.setGeometryPoints(this.points)}getPoints(){return this.points}}const ce={FineArrow:ue,AttackArrow:bt,SwallowtailAttackArrow:qi,SquadCombat:ge,SwallowtailSquadCombat:Xi,StraightArrow:Yi,CurvedArrow:Ki,AssaultDirection:$i,DoubleArrow:Ji,FreehandLine:Qi,FreehandPolygon:Zi,Curve:ts,Ellipse:es,Lune:is,Reactangle:ss,Triangle:ns,Polygon:os,Circle:rs,Sector:as,GatheringPlace:hs,Arc:cs,Polyline:ls,ClosedCurve:us,Point:gs};ce.createGeometryFromData=(c,t,e)=>{console.log("");const{type:i,style:o,cartesianPoints:n}=e,r=new ce[i](c,t,o);r.points=n;const a=r.createGraphic(n);return r.setGeometryPoints(a),r.type=="polygon"?r.drawPolygon():r.drawLine(),r.finishDrawing(),r.onClick(),r};export{ce as C};
